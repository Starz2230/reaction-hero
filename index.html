<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!-- Viewport für korrektes Scaling auf Mobilgeräten -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reaction Hero ⚡</title>
  <link rel="manifest" href="manifest.json">

  <!-- Inline-CSS für dunkles Design und Layout -->
  <style>
    /* Reset & Box-Sizing */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    /* Wrapper zentriert den Content */
    #wrapper {
      width: 100%;
      max-width: 480px;
      text-align: center;
    }

    /* Titel */
    h1 {
      font-size: 1.75rem;
      margin-bottom: 1.5rem;
      color: #ffffff;
    }

    /* Spiel-Button */
    #screen {
      display: block;
      margin: 0 auto;
      width: 200px;
      height: 200px;
      border: none;
      border-radius: 50%;
      background-color: #b71c1c; /* dunkelrot = “wait” */
      color: #ffffff;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      user-select: none;
    }
    #screen.go {
      background-color: #1b5e20; /* dunkelgrün = “go” */
    }
    #screen:active {
      transform: scale(0.95);
    }

    /* Ergebnis-Anzeige */
    #result {
      margin-top: 1rem;
      font-size: 1.25rem;
      height: 1.5em;
      color: #ffffff;
    }

    /* Start/Stop-Button */
    #startStopBtn {
      margin: 1rem auto 0;
      background-color: #0d47a1;
      color: #ffffff;
      border: none;
      border-radius: 4px;
      padding: 0.5rem 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
      font-size: 1rem;
    }
    #startStopBtn:hover {
      background-color: #1565c0;
    }

    /* Lokales Scoreboard */
    #localBoardContainer {
      margin-top: 2rem;
      background-color: #1e1e1e;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.5);
      text-align: left;
    }
    #localBoardContainer h2 {
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
      color: #fafafa;
    }
    /* Einheitliche Einrückung der Listenpunkte */
    #localBoard {
      list-style: decimal inside;
      padding-left: 0;
      margin-left: 0;
      color: #e0e0e0;
    }
    #localBoard li {
      margin-bottom: 0.4rem;
      font-size: 1rem;
    }

    /* Größere Darstellung auf breiteren Bildschirmen */
    @media (min-width: 600px) {
      #screen {
        width: 240px;
        height: 240px;
        font-size: 1.75rem;
      }
      #wrapper {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <!-- Titel -->
    <h1>Reaction Hero ⚡</h1>

    <!-- Spiel-Button -->
    <button id="screen" class="wait">Wait…</button>
    <p id="result"></p>

    <!-- Start/Stop-Button -->
    <button id="startStopBtn">Start</button>

    <!-- Lokales Scoreboard -->
    <div id="localBoardContainer">
      <h2>Your Records</h2>
      <ol id="localBoard">
        <!-- Lokale Best-Zeiten kommen hier rein -->
      </ol>
    </div>
  </div>

  <!-- ----------------------------
       JavaScript: Spiel-Logik (nur lokal)
       ---------------------------- -->
  <script>
    // DOM-Elemente holen
    const screen = document.getElementById("screen");
    const resultP = document.getElementById("result");
    const startStopBtn = document.getElementById("startStopBtn");
    const localBoardEl = document.getElementById("localBoard");

    // Spiel-Variablen
    let startTime = 0;
    let timerId = null;
    let gameActive = false;                // false = pausiert / keine Runde läuft, true = Runde aktiv
    let playerName = "";                   // Nur lokal, kann man weglassen oder nach Wunsch anpassen

    // Name per prompt()-Abfrage (optional, speichert in localStorage, wird nicht weiter verwendet)
    function askForName() {
      const name = prompt("Enter your nickname (or leave blank for 'Anonymous'):");
      playerName = (name && name.trim()) ? name.trim() : "Anonymous";
      localStorage.setItem("playerName", playerName);
    }

    // Beim Laden der Seite: Namen abfragen / lokale Rangliste anzeigen
    window.addEventListener("load", () => {
      askForName();
      showLocalBoard();
      // Hinweis: gameActive bleibt false, bis der Nutzer auf „Start“ klickt
    });

    // Funktion: Neue Runde starten (Button rot → grün nach Zufallsverzögerung)
    function startRound() {
      screen.classList.remove("go");
      screen.classList.add("wait");
      screen.textContent = "Wait…";
      resultP.textContent = "";

      const delay = 1000 + Math.random() * 3000; // 1–4 Sekunden
      timerId = setTimeout(() => {
        if (!gameActive) return; // Falls der Nutzer in der Zwischenzeit auf "Stop" geklickt hat
        screen.classList.remove("wait");
        screen.classList.add("go");
        screen.textContent = "Tap NOW!";
        startTime = performance.now();
      }, delay);
    }

    // Klick-Handler für den Spiel-Button
    screen.addEventListener("click", () => {
      // Nur reagieren, wenn gerade eine Runde aktiv ist UND der Button grün ist
      if (!gameActive || !screen.classList.contains("go")) return;

      // Reaktionszeit bestimmen
      const time = Math.floor(performance.now() - startTime);
      resultP.textContent = `${time} ms`;

      // 1) Speichere in localStorage
      saveLocalScore(time);
      showLocalBoard();

      // 2) Beende die Runde, Button wieder auf "Start"
      gameActive = false;
      startStopBtn.textContent = "Start";
      clearTimeout(timerId);
    });

    // Klick-Handler für Start/Stop
    startStopBtn.addEventListener("click", () => {
      if (!gameActive) {
        // Starte eine neue Runde
        gameActive = true;
        startStopBtn.textContent = "Stop";
        startRound();
      } else {
        // Stoppe die gerade laufende Runde
        gameActive = false;
        startStopBtn.textContent = "Start";
        clearTimeout(timerId);
        // Button zurück in Wartezustand setzen
        screen.classList.remove("go");
        screen.classList.add("wait");
        screen.textContent = "Wait…";
        resultP.textContent = "";
      }
    });

    // Speichern eines neuen Highscores in localStorage (Top 5)
    function saveLocalScore(time) {
      const list = JSON.parse(localStorage.getItem("scores") || "[]");
      list.push(time);
      list.sort((a, b) => a - b);
      localStorage.setItem("scores", JSON.stringify(list.slice(0, 5)));
    }

    // Anzeigen der lokal gespeicherten Top-5
    function showLocalBoard() {
      const list = JSON.parse(localStorage.getItem("scores") || "[]");
      if (!list.length) {
        localBoardEl.innerHTML = "<li>No records yet.</li>";
        return;
      }
      localBoardEl.innerHTML = list.map(t => `<li>${t} ms</li>`).join("");
    }

    // Service Worker registrieren (wenn unterstützt)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error:', err));
      });
    }
  </script>
</body>
</html>
